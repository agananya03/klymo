{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/src/utils/device-id.ts"],"sourcesContent":["import FingerprintJS from '@fingerprintjs/fingerprintjs';\r\nimport { openDB } from 'idb';\r\n\r\nconst DB_NAME = 'anonymousChat';\r\nconst STORE_NAME = 'identity';\r\nconst KEY_NAME = 'deviceId';\r\n\r\nasync function getStoredDeviceId(): Promise<string | undefined> {\r\n  try {\r\n    const db = await openDB(DB_NAME, 1, {\r\n      upgrade(db) {\r\n        db.createObjectStore(STORE_NAME);\r\n      },\r\n    });\r\n    return await db.get(STORE_NAME, KEY_NAME);\r\n  } catch (error) {\r\n    console.error('Error accessing IndexedDB:', error);\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function storeDeviceId(deviceId: string): Promise<void> {\r\n  try {\r\n    const db = await openDB(DB_NAME, 1);\r\n    await db.put(STORE_NAME, deviceId, KEY_NAME);\r\n  } catch (error) {\r\n    console.error('Error storing to IndexedDB:', error);\r\n  }\r\n}\r\n\r\nasync function hashString(str: string): Promise<string> {\r\n  const msgBuffer = new TextEncoder().encode(str);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\nexport async function generateDeviceId(): Promise<string> {\r\n  // 1. Check if ID already exists in IndexedDB\r\n  const storedId = await getStoredDeviceId();\r\n  if (storedId) {\r\n    console.log('Device ID retrieved from storage:', storedId);\r\n    return storedId;\r\n  }\r\n\r\n  // 2. Initialize FingerprintJS\r\n  const fp = await FingerprintJS.load();\r\n  const result = await fp.get();\r\n  \r\n  // 3. Collect entropy sources\r\n  const entropy = {\r\n    visitorId: result.visitorId,\r\n    language: navigator.language,\r\n    screenWidth: screen.width,\r\n    screenHeight: screen.height,\r\n    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,\r\n    userAgent: navigator.userAgent,\r\n  };\r\n\r\n  // 4. Create a consistent string from entropy\r\n  // Sorting keys to ensure consistency regardless of object property order\r\n  const entropyString = Object.keys(entropy)\r\n    .sort()\r\n    .map((key) => `${key}:${entropy[key as keyof typeof entropy]}`)\r\n    .join('|');\r\n\r\n  console.log('Entropy string for hashing:', entropyString);\r\n\r\n  // 5. Hash the combined string\r\n  const deviceId = await hashString(entropyString);\r\n\r\n  // 6. Store in IndexedDB\r\n  await storeDeviceId(deviceId);\r\n  console.log('New Device ID generated and stored:', deviceId);\r\n\r\n  return deviceId;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,UAAU;AAChB,MAAM,aAAa;AACnB,MAAM,WAAW;AAEjB,eAAe;IACb,IAAI;QACF,MAAM,KAAK,MAAM,IAAA,kJAAM,EAAC,SAAS,GAAG;YAClC,SAAQ,EAAE;gBACR,GAAG,iBAAiB,CAAC;YACvB;QACF;QACA,OAAO,MAAM,GAAG,GAAG,CAAC,YAAY;IAClC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACT;AACF;AAEA,eAAe,cAAc,QAAgB;IAC3C,IAAI;QACF,MAAM,KAAK,MAAM,IAAA,kJAAM,EAAC,SAAS;QACjC,MAAM,GAAG,GAAG,CAAC,YAAY,UAAU;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;IAC/C;AACF;AAEA,eAAe,WAAW,GAAW;IACnC,MAAM,YAAY,IAAI,cAAc,MAAM,CAAC;IAC3C,MAAM,aAAa,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACzD,MAAM,YAAY,MAAM,IAAI,CAAC,IAAI,WAAW;IAC5C,OAAO,UAAU,GAAG,CAAC,CAAC,IAAM,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM,IAAI,CAAC;AACpE;AAEO,eAAe;IACpB,6CAA6C;IAC7C,MAAM,WAAW,MAAM;IACvB,IAAI,UAAU;QACZ,QAAQ,GAAG,CAAC,qCAAqC;QACjD,OAAO;IACT;IAEA,8BAA8B;IAC9B,MAAM,KAAK,MAAM,mLAAa,CAAC,IAAI;IACnC,MAAM,SAAS,MAAM,GAAG,GAAG;IAE3B,6BAA6B;IAC7B,MAAM,UAAU;QACd,WAAW,OAAO,SAAS;QAC3B,UAAU,UAAU,QAAQ;QAC5B,aAAa,OAAO,KAAK;QACzB,cAAc,OAAO,MAAM;QAC3B,UAAU,KAAK,cAAc,GAAG,eAAe,GAAG,QAAQ;QAC1D,WAAW,UAAU,SAAS;IAChC;IAEA,6CAA6C;IAC7C,yEAAyE;IACzE,MAAM,gBAAgB,OAAO,IAAI,CAAC,SAC/B,IAAI,GACJ,GAAG,CAAC,CAAC,MAAQ,GAAG,IAAI,CAAC,EAAE,OAAO,CAAC,IAA4B,EAAE,EAC7D,IAAI,CAAC;IAER,QAAQ,GAAG,CAAC,+BAA+B;IAE3C,8BAA8B;IAC9B,MAAM,WAAW,MAAM,WAAW;IAElC,wBAAwB;IACxB,MAAM,cAAc;IACpB,QAAQ,GAAG,CAAC,uCAAuC;IAEnD,OAAO;AACT"}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/DeviceIdDisplay.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { generateDeviceId } from '@/utils/device-id';\r\n\r\nexport default function DeviceIdDisplay() {\r\n    const [deviceId, setDeviceId] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        let mounted = true;\r\n\r\n        async function fetchId() {\r\n            try {\r\n                const id = await generateDeviceId();\r\n                if (mounted) {\r\n                    setDeviceId(id);\r\n                }\r\n            } catch (error) {\r\n                console.error('Failed to generate device ID', error);\r\n            } finally {\r\n                if (mounted) {\r\n                    setLoading(false);\r\n                }\r\n            }\r\n        }\r\n\r\n        fetchId();\r\n\r\n        return () => {\r\n            mounted = false;\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"p-4 bg-gray-100 rounded-lg shadow-sm border border-gray-200 max-w-md mt-4 dark:bg-gray-800 dark:border-gray-700\">\r\n            <h3 className=\"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2 dark:text-gray-400\">\r\n                Device Identity\r\n            </h3>\r\n            {loading ? (\r\n                <div className=\"animate-pulse h-6 w-3/4 bg-gray-300 rounded dark:bg-gray-700\"></div>\r\n            ) : (\r\n                <div className=\"flex flex-col gap-1\">\r\n                    <code className=\"bg-white px-2 py-1 rounded border border-gray-200 font-mono text-sm break-all text-gray-800 dark:bg-gray-900 dark:border-gray-600 dark:text-gray-200\">\r\n                        {deviceId || 'Error generating ID'}\r\n                    </code>\r\n                    <p className=\"text-xs text-gray-400 mt-1\">\r\n                        Persisted in IndexedDB. Hashed from browser entropy.\r\n                    </p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS;;IACpB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAgB;IACxD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,IAAA,0KAAS;qCAAC;YACN,IAAI,UAAU;YAEd,eAAe;gBACX,IAAI;oBACA,MAAM,KAAK,MAAM,IAAA,mJAAgB;oBACjC,IAAI,SAAS;wBACT,YAAY;oBAChB;gBACJ,EAAE,OAAO,OAAO;oBACZ,QAAQ,KAAK,CAAC,gCAAgC;gBAClD,SAAU;oBACN,IAAI,SAAS;wBACT,WAAW;oBACf;gBACJ;YACJ;YAEA;YAEA;6CAAO;oBACH,UAAU;gBACd;;QACJ;oCAAG,EAAE;IAEL,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAG,WAAU;0BAAsF;;;;;;YAGnG,wBACG,6LAAC;gBAAI,WAAU;;;;;qCAEf,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAK,WAAU;kCACX,YAAY;;;;;;kCAEjB,6LAAC;wBAAE,WAAU;kCAA6B;;;;;;;;;;;;;;;;;;AAO9D;GAhDwB;KAAA"}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/CameraCapture.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef, useCallback, useEffect } from 'react';\r\n\r\ninterface CameraCaptureProps {\r\n    onCapture?: (imageData: string) => void;\r\n    width?: number;\r\n    height?: number;\r\n}\r\n\r\nexport default function CameraCapture({\r\n    onCapture,\r\n    width = 640,\r\n    height = 480\r\n}: CameraCaptureProps) {\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [isStreaming, setIsStreaming] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [capturedImage, setCapturedImage] = useState<string | null>(null);\r\n\r\n    const startCamera = async () => {\r\n        console.log(\"Starting camera...\");\r\n        try {\r\n            setError(null);\r\n            console.log(\"Requesting user media...\");\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                video: { facingMode: 'user' }\r\n            });\r\n            console.log(\"Stream acquired:\", stream);\r\n\r\n            if (videoRef.current) {\r\n                console.log(\"Setting video srcObject\");\r\n                videoRef.current.srcObject = stream;\r\n                videoRef.current.play();\r\n                setIsStreaming(true);\r\n            } else {\r\n                console.error(\"Video ref is null\");\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Error accessing camera:\", err);\r\n            setError(\"Could not access camera. Please ensure permissions are granted.\");\r\n        }\r\n    };\r\n\r\n    const stopCamera = useCallback(() => {\r\n        if (videoRef.current && videoRef.current.srcObject) {\r\n            const stream = videoRef.current.srcObject as MediaStream;\r\n            const tracks = stream.getTracks();\r\n            tracks.forEach(track => track.stop());\r\n            videoRef.current.srcObject = null;\r\n            setIsStreaming(false);\r\n        }\r\n    }, []);\r\n\r\n    const takePhoto = useCallback(() => {\r\n        const video = videoRef.current;\r\n        const canvas = canvasRef.current;\r\n\r\n        if (video && canvas) {\r\n            const context = canvas.getContext('2d');\r\n            if (context) {\r\n                // Match canvas size to video size\r\n                canvas.width = video.videoWidth;\r\n                canvas.height = video.videoHeight;\r\n\r\n                // Draw video frame to canvas\r\n                context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n                // Get base64 string\r\n                const dataUrl = canvas.toDataURL('image/jpeg');\r\n                setCapturedImage(dataUrl);\r\n\r\n                if (onCapture) {\r\n                    onCapture(dataUrl);\r\n                }\r\n            }\r\n        }\r\n    }, [onCapture]);\r\n\r\n    const retake = () => {\r\n        setCapturedImage(null);\r\n        startCamera();\r\n    };\r\n\r\n    // Clean up on unmount\r\n    useEffect(() => {\r\n        return () => {\r\n            stopCamera();\r\n        };\r\n    }, [stopCamera]);\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center gap-4 p-4 border rounded-lg shadow-md max-w-md mx-auto bg-white dark:bg-gray-800\">\r\n            <div className=\"relative w-full aspect-video bg-black rounded-lg overflow-hidden\">\r\n                {!isStreaming && !capturedImage && !error && (\r\n                    <div className=\"absolute inset-0 flex items-center justify-center text-white\">\r\n                        <button\r\n                            onClick={startCamera}\r\n                            className=\"px-4 py-2 bg-blue-600 rounded-md hover:bg-blue-700 transition\"\r\n                        >\r\n                            Start Camera\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                {error && (\r\n                    <div className=\"absolute inset-0 flex items-center justify-center text-red-500 p-4 text-center\">\r\n                        {error}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Video Preview */}\r\n                <video\r\n                    ref={videoRef}\r\n                    className={`w-full h-full object-cover ${capturedImage ? 'hidden' : 'block'}`}\r\n                    playsInline\r\n                    muted\r\n                    autoPlay\r\n                />\r\n\r\n                {/* Captured Image Preview */}\r\n                {capturedImage && (\r\n                    <img\r\n                        src={capturedImage}\r\n                        alt=\"Captured\"\r\n                        className=\"w-full h-full object-cover\"\r\n                    />\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"flex gap-4\">\r\n                {isStreaming && !capturedImage && (\r\n                    <button\r\n                        onClick={takePhoto}\r\n                        className=\"px-6 py-2 bg-green-600 text-white rounded-full font-bold hover:bg-green-700 shadow-lg transition transform active:scale-95\"\r\n                    >\r\n                        Capture\r\n                    </button>\r\n                )}\r\n\r\n                {capturedImage && (\r\n                    <button\r\n                        onClick={retake}\r\n                        className=\"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition\"\r\n                    >\r\n                        Retake\r\n                    </button>\r\n                )}\r\n\r\n                {isStreaming && (\r\n                    <button\r\n                        onClick={stopCamera}\r\n                        className=\"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition\"\r\n                    >\r\n                        Stop\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {/* Hidden canvas for capturing */}\r\n            <canvas ref={canvasRef} className=\"hidden\" />\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}