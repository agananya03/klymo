{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/src/utils/device-id.ts"],"sourcesContent":["import FingerprintJS from '@fingerprintjs/fingerprintjs';\r\nimport { openDB } from 'idb';\r\n\r\nconst DB_NAME = 'anonymousChat';\r\nconst STORE_NAME = 'identity';\r\nconst KEY_NAME = 'deviceId';\r\n\r\nasync function getStoredDeviceId(): Promise<string | undefined> {\r\n  try {\r\n    const db = await openDB(DB_NAME, 1, {\r\n      upgrade(db) {\r\n        db.createObjectStore(STORE_NAME);\r\n      },\r\n    });\r\n    return await db.get(STORE_NAME, KEY_NAME);\r\n  } catch (error) {\r\n    console.error('Error accessing IndexedDB:', error);\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function storeDeviceId(deviceId: string): Promise<void> {\r\n  try {\r\n    const db = await openDB(DB_NAME, 1);\r\n    await db.put(STORE_NAME, deviceId, KEY_NAME);\r\n  } catch (error) {\r\n    console.error('Error storing to IndexedDB:', error);\r\n  }\r\n}\r\n\r\nasync function hashString(str: string): Promise<string> {\r\n  const msgBuffer = new TextEncoder().encode(str);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\nexport async function generateDeviceId(): Promise<string> {\r\n  // 1. Check if ID already exists in IndexedDB\r\n  const storedId = await getStoredDeviceId();\r\n  if (storedId) {\r\n    console.log('Device ID retrieved from storage:', storedId);\r\n    return storedId;\r\n  }\r\n\r\n  // 2. Initialize FingerprintJS\r\n  const fp = await FingerprintJS.load();\r\n  const result = await fp.get();\r\n  \r\n  // 3. Collect entropy sources\r\n  const entropy = {\r\n    visitorId: result.visitorId,\r\n    language: navigator.language,\r\n    screenWidth: screen.width,\r\n    screenHeight: screen.height,\r\n    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,\r\n    userAgent: navigator.userAgent,\r\n  };\r\n\r\n  // 4. Create a consistent string from entropy\r\n  // Sorting keys to ensure consistency regardless of object property order\r\n  const entropyString = Object.keys(entropy)\r\n    .sort()\r\n    .map((key) => `${key}:${entropy[key as keyof typeof entropy]}`)\r\n    .join('|');\r\n\r\n  console.log('Entropy string for hashing:', entropyString);\r\n\r\n  // 5. Hash the combined string\r\n  const deviceId = await hashString(entropyString);\r\n\r\n  // 6. Store in IndexedDB\r\n  await storeDeviceId(deviceId);\r\n  console.log('New Device ID generated and stored:', deviceId);\r\n\r\n  return deviceId;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,UAAU;AAChB,MAAM,aAAa;AACnB,MAAM,WAAW;AAEjB,eAAe;IACb,IAAI;QACF,MAAM,KAAK,MAAM,IAAA,kJAAM,EAAC,SAAS,GAAG;YAClC,SAAQ,EAAE;gBACR,GAAG,iBAAiB,CAAC;YACvB;QACF;QACA,OAAO,MAAM,GAAG,GAAG,CAAC,YAAY;IAClC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACT;AACF;AAEA,eAAe,cAAc,QAAgB;IAC3C,IAAI;QACF,MAAM,KAAK,MAAM,IAAA,kJAAM,EAAC,SAAS;QACjC,MAAM,GAAG,GAAG,CAAC,YAAY,UAAU;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;IAC/C;AACF;AAEA,eAAe,WAAW,GAAW;IACnC,MAAM,YAAY,IAAI,cAAc,MAAM,CAAC;IAC3C,MAAM,aAAa,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACzD,MAAM,YAAY,MAAM,IAAI,CAAC,IAAI,WAAW;IAC5C,OAAO,UAAU,GAAG,CAAC,CAAC,IAAM,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM,IAAI,CAAC;AACpE;AAEO,eAAe;IACpB,6CAA6C;IAC7C,MAAM,WAAW,MAAM;IACvB,IAAI,UAAU;QACZ,QAAQ,GAAG,CAAC,qCAAqC;QACjD,OAAO;IACT;IAEA,8BAA8B;IAC9B,MAAM,KAAK,MAAM,mLAAa,CAAC,IAAI;IACnC,MAAM,SAAS,MAAM,GAAG,GAAG;IAE3B,6BAA6B;IAC7B,MAAM,UAAU;QACd,WAAW,OAAO,SAAS;QAC3B,UAAU,UAAU,QAAQ;QAC5B,aAAa,OAAO,KAAK;QACzB,cAAc,OAAO,MAAM;QAC3B,UAAU,KAAK,cAAc,GAAG,eAAe,GAAG,QAAQ;QAC1D,WAAW,UAAU,SAAS;IAChC;IAEA,6CAA6C;IAC7C,yEAAyE;IACzE,MAAM,gBAAgB,OAAO,IAAI,CAAC,SAC/B,IAAI,GACJ,GAAG,CAAC,CAAC,MAAQ,GAAG,IAAI,CAAC,EAAE,OAAO,CAAC,IAA4B,EAAE,EAC7D,IAAI,CAAC;IAER,QAAQ,GAAG,CAAC,+BAA+B;IAE3C,8BAA8B;IAC9B,MAAM,WAAW,MAAM,WAAW;IAElC,wBAAwB;IACxB,MAAM,cAAc;IACpB,QAAQ,GAAG,CAAC,uCAAuC;IAEnD,OAAO;AACT"}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/CameraCapture.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { generateDeviceId } from '@/utils/device-id';\r\n\r\ninterface CameraCaptureProps {\r\n    onCapture?: (blobSize: string) => void;\r\n}\r\n\r\nexport default function CameraCapture({ onCapture }: CameraCaptureProps) {\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [isStreaming, setIsStreaming] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [verificationStatus, setVerificationStatus] = useState<'idle' | 'success' | 'failed'>('idle');\r\n    const [verificationMessage, setVerificationMessage] = useState<string>('');\r\n\r\n    const startCamera = async () => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        setVerificationStatus('idle');\r\n        setVerificationMessage('');\r\n\r\n        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n            setError(\"Camera API is not supported in this browser\");\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Strict constraint for user-facing camera\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                video: { facingMode: 'user', width: 640, height: 480 }\r\n            });\r\n\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = stream;\r\n                videoRef.current.onloadedmetadata = () => {\r\n                    videoRef.current?.play().catch(e => console.error(\"Play error:\", e));\r\n                    setIsStreaming(true);\r\n                    setIsLoading(false);\r\n                };\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Error accessing camera:\", err);\r\n            setError(`Camera access denied. Please allow permissions to verify.`);\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const stopCamera = useCallback(() => {\r\n        if (videoRef.current && videoRef.current.srcObject) {\r\n            const stream = videoRef.current.srcObject as MediaStream;\r\n            const tracks = stream.getTracks();\r\n            tracks.forEach(track => track.stop());\r\n            videoRef.current.srcObject = null;\r\n            setIsStreaming(false);\r\n        }\r\n    }, []);\r\n\r\n    const captureAndVerify = async () => {\r\n        if (!videoRef.current || !canvasRef.current) return;\r\n\r\n        setIsLoading(true);\r\n        const canvas = canvasRef.current;\r\n        const video = videoRef.current;\r\n\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            setError(\"Internal error: Canvas context missing\");\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n\r\n        // Draw current frame\r\n        ctx.drawImage(video, 0, 0);\r\n\r\n        // Convert to Blob (JPEG 92%)\r\n        canvas.toBlob(async (blob) => {\r\n            if (!blob) {\r\n                setError(\"Failed to capture image\");\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            // Immediately stop camera privacy rule\r\n            stopCamera();\r\n\r\n            try {\r\n                const deviceId = await generateDeviceId();\r\n                console.log(\"Starting verification request...\"); // Force HMR update\r\n                const formData = new FormData();\r\n                formData.append('file', blob, 'capture.jpg');\r\n                formData.append('device_id', deviceId);\r\n\r\n                // Use relative path to leverage Next.js proxy\r\n                const response = await fetch('/api/v1/verification/verify-gender', {\r\n                    method: 'POST',\r\n                    body: formData,\r\n                });\r\n\r\n                const result = await response.json();\r\n\r\n                if (!response.ok) {\r\n                    throw new Error(result.detail || 'Verification failed');\r\n                }\r\n\r\n                setVerificationStatus('success');\r\n                setVerificationMessage(`Verified as ${result.gender} (${(result.confidence * 100).toFixed(1)}%)`);\r\n\r\n                // Trigger parent callback after short delay for UX\r\n                if (onCapture) {\r\n                    setTimeout(() => onCapture(blob.size.toString()), 1500);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Verification error:\", err);\r\n                setVerificationStatus('failed');\r\n                setVerificationMessage(err instanceof Error ? err.message : \"Verification failed\");\r\n                // Allow retrying\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n\r\n        }, 'image/jpeg', 0.92);\r\n    };\r\n\r\n    // Cleanup\r\n    useEffect(() => {\r\n        return () => stopCamera();\r\n    }, [stopCamera]);\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center gap-6 p-6 border rounded-xl shadow-lg max-w-lg mx-auto bg-white dark:bg-gray-800 transition-all\">\r\n            <h3 className=\"text-xl font-bold text-gray-800 dark:text-white\">\r\n                Identity Verification\r\n            </h3>\r\n\r\n            <div className={`relative w-full aspect-video bg-black rounded-lg overflow-hidden border-2 ${verificationStatus === 'success' ? 'border-green-500' :\r\n                verificationStatus === 'failed' ? 'border-red-500' : 'border-gray-200 dark:border-gray-700'\r\n                }`}>\r\n\r\n                {/* Initial State / Messages */}\r\n                {!isStreaming && (\r\n                    <div className=\"absolute inset-0 flex flex-col items-center justify-center p-4 text-center z-10 bg-black/80 text-white\">\r\n                        {verificationStatus === 'success' ? (\r\n                            <div className=\"text-green-400\">\r\n                                <span className=\"text-4xl\">‚úì</span>\r\n                                <p className=\"mt-2 font-semibold\">{verificationMessage}</p>\r\n                                <p className=\"text-sm opacity-75 mt-1\">Image discarded for privacy.</p>\r\n                            </div>\r\n                        ) : verificationStatus === 'failed' ? (\r\n                            <div className=\"text-red-400\">\r\n                                <span className=\"text-4xl\">‚ö†</span>\r\n                                <p className=\"mt-2 font-semibold\">{verificationMessage}</p>\r\n                                <button\r\n                                    onClick={startCamera}\r\n                                    className=\"mt-4 px-4 py-2 bg-white text-red-600 rounded-full text-sm font-bold hover:bg-gray-200\"\r\n                                >\r\n                                    Try Again\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-4\">\r\n                                <p className=\"text-sm opacity-90 max-w-xs mx-auto\">\r\n                                    Instant camera-only verification. No uploads allowed.\r\n                                    Images are processed in memory and immediately deleted.\r\n                                </p>\r\n                                <button\r\n                                    onClick={startCamera}\r\n                                    disabled={isLoading}\r\n                                    className=\"px-6 py-3 bg-blue-600 rounded-full font-bold hover:bg-blue-700 transition disabled:opacity-50\"\r\n                                >\r\n                                    {isLoading ? 'Starting...' : 'Enable Camera'}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n\r\n                        {error && (\r\n                            <p className=\"mt-4 text-red-500 bg-black/90 px-3 py-1 rounded\">{error}</p>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                <video\r\n                    ref={videoRef}\r\n                    className=\"w-full h-full object-cover\"\r\n                    playsInline\r\n                    muted\r\n                    autoPlay\r\n                />\r\n            </div>\r\n\r\n            {isStreaming && (\r\n                <div className=\"flex flex-col items-center gap-3 w-full\">\r\n                    <button\r\n                        onClick={captureAndVerify}\r\n                        disabled={isLoading}\r\n                        className=\"w-full px-6 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 shadow-lg transition transform active:scale-98 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                        {isLoading ? 'Verifying...' : 'Verify Identity'}\r\n                    </button>\r\n                    <p className=\"text-xs text-gray-400\">\r\n                        By verifying, you confirm this is your real photo.\r\n                    </p>\r\n                </div>\r\n            )}\r\n\r\n            <canvas ref={canvasRef} className=\"hidden\" />\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 404, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/ProfileForm.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { generateDeviceId } from '@/utils/device-id';\r\n\r\ninterface ProfileFormProps {\r\n    onProfileComplete: () => void;\r\n}\r\n\r\nexport default function ProfileForm({ onProfileComplete }: ProfileFormProps) {\r\n    const [nickname, setNickname] = useState('');\r\n    const [bio, setBio] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [status, setStatus] = useState<string | null>(null);\r\n    const [deviceId, setDeviceId] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        // Load device ID and check for existing profile\r\n        const loadProfile = async () => {\r\n            const id = await generateDeviceId();\r\n            setDeviceId(id);\r\n            try {\r\n                // Use relative path for proxy\r\n                const res = await fetch(`/api/v1/profiles/${id}`);\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    if (data.nickname) setNickname(data.nickname);\r\n                    if (data.bio) setBio(data.bio);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to load profile\", err);\r\n            }\r\n        };\r\n        loadProfile();\r\n    }, []);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!deviceId) return;\r\n\r\n        setIsLoading(true);\r\n        setStatus(null);\r\n\r\n        try {\r\n            const res = await fetch('/api/v1/profiles', {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    device_id: deviceId,\r\n                    nickname: nickname.trim(),\r\n                    bio: bio.trim()\r\n                }),\r\n            });\r\n\r\n            if (!res.ok) throw new Error('Failed to save profile');\r\n\r\n            setStatus('Profile saved successfully!');\r\n            setStatus('Profile saved successfully!');\r\n            console.log(\"Calling onProfileComplete immediately\");\r\n            onProfileComplete(); // Immediate call for debugging\r\n        } catch (err) {\r\n            setStatus('Error saving profile. Please try again.');\r\n            console.error(err);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleClear = async () => {\r\n        if (!deviceId || !confirm(\"Are you sure you want to clear your profile data?\")) return;\r\n\r\n        setIsLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/v1/profiles/${deviceId}`, {\r\n                method: 'DELETE'\r\n            });\r\n            if (!res.ok) throw new Error('Failed to clear profile');\r\n\r\n            setNickname('');\r\n            setBio('');\r\n            setStatus('Profile data cleared.');\r\n        } catch (err) {\r\n            setStatus('Error clearing data.');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full max-w-md p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n            <h3 className=\"text-xl font-bold mb-2 text-gray-900 dark:text-gray-100\">Setup Profile</h3>\r\n            <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-6\">\r\n                Your nickname is temporary. No profile pictures are allowed for privacy.\r\n            </p>\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                <div>\r\n                    <label className=\"block text-xs font-semibold uppercase text-gray-500 mb-1\">Nickname</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        value={nickname}\r\n                        onChange={(e) => setNickname(e.target.value)}\r\n                        placeholder=\"e.g. MysteryWalker\"\r\n                        maxLength={50}\r\n                        required\r\n                        className=\"w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none transition\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-xs font-semibold uppercase text-gray-500 mb-1\">Short Bio (Optional)</label>\r\n                    <textarea\r\n                        value={bio}\r\n                        onChange={(e) => setBio(e.target.value)}\r\n                        placeholder=\"Just here to chat...\"\r\n                        maxLength={200}\r\n                        rows={3}\r\n                        className=\"w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none transition resize-none\"\r\n                    />\r\n                </div>\r\n\r\n                {status && (\r\n                    <p className={`text-sm text-center font-medium ${status.includes('Error') ? 'text-red-500' : 'text-green-500'}`}>\r\n                        {status}\r\n                    </p>\r\n                )}\r\n\r\n                <div className=\"flex gap-3 pt-2\">\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={isLoading || !nickname.trim()}\r\n                        className=\"flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition transform active:scale-95\"\r\n                    >\r\n                        {isLoading ? 'Saving...' : 'Continue'}\r\n                    </button>\r\n                    {nickname && (\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={handleClear}\r\n                            disabled={isLoading}\r\n                            className=\"px-4 py-3 text-red-500 font-semibold hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                            title=\"Clear Profile Data\"\r\n                        >\r\n                            Clear\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 635, "column": 0}, "map": {"version":3,"sources":["file:///app/src/utils/socket.ts"],"sourcesContent":["import { io, Socket } from 'socket.io-client';\r\n\r\n// Direct connection to backend (local dev)\r\nconst SOCKET_URL = 'http://localhost:8000';\r\n\r\nlet socket: Socket | null = null;\r\n\r\nexport const getSocket = (): Socket => {\r\n    if (!socket) {\r\n        // Initialize socket only when requested\r\n        // Auto-connect is true by default, but we might want to control it\r\n        // We will pass auth in connect logic or here if we have it globally\r\n        socket = io(SOCKET_URL, {\r\n            path: '/socket.io', // Matches backend mount\r\n            autoConnect: false, // We connect manually after profile/verification\r\n            transports: ['websocket', 'polling'],\r\n        });\r\n    }\r\n    return socket;\r\n};\r\n\r\nexport const disconnectSocket = () => {\r\n    if (socket) {\r\n        socket.disconnect();\r\n        socket = null;\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,2CAA2C;AAC3C,MAAM,aAAa;AAEnB,IAAI,SAAwB;AAErB,MAAM,YAAY;IACrB,IAAI,CAAC,QAAQ;QACT,wCAAwC;QACxC,mEAAmE;QACnE,oEAAoE;QACpE,SAAS,IAAA,wLAAE,EAAC,YAAY;YACpB,MAAM;YACN,aAAa;YACb,YAAY;gBAAC;gBAAa;aAAU;QACxC;IACJ;IACA,OAAO;AACX;AAEO,MAAM,mBAAmB;IAC5B,IAAI,QAAQ;QACR,OAAO,UAAU;QACjB,SAAS;IACb;AACJ"}},
    {"offset": {"line": 675, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/MatchingQueue.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { getSocket, disconnectSocket } from '@/utils/socket';\r\nimport { generateDeviceId } from '@/utils/device-id';\r\n\r\ninterface MatchingQueueProps {\r\n    onMatchFound: (sessionData: any) => void;\r\n    autoJoin?: boolean;\r\n    initialPreference?: 'male' | 'female' | 'any';\r\n    onPreferenceSelect?: (pref: 'male' | 'female' | 'any') => void;\r\n}\r\n\r\nexport default function MatchingQueue({\r\n    onMatchFound,\r\n    autoJoin = false,\r\n    initialPreference = 'any',\r\n    onPreferenceSelect\r\n}: MatchingQueueProps) {\r\n    const [status, setStatus] = useState('Connecting...');\r\n    const [preference, setPreference] = useState<'male' | 'female' | 'any'>(initialPreference);\r\n\r\n    // Track if we have already triggered auto-join to prevent double emits\r\n    const autoJoinedRef = useRef(false);\r\n\r\n    useEffect(() => {\r\n        const connectAndJoin = async () => {\r\n            const deviceId = await generateDeviceId();\r\n            const socket = getSocket();\r\n\r\n            if (!socket.connected) {\r\n                socket.auth = { device_id: deviceId };\r\n                socket.connect();\r\n            }\r\n\r\n            const handleConnect = () => {\r\n                if (autoJoin && !autoJoinedRef.current) {\r\n                    setStatus(`Auto-joining queue for ${initialPreference}...`);\r\n                    socket.emit('join_queue', { preference: initialPreference });\r\n                    autoJoinedRef.current = true;\r\n                } else {\r\n                    setStatus('Select a preference');\r\n                }\r\n            };\r\n\r\n            if (socket.connected) {\r\n                handleConnect();\r\n            } else {\r\n                socket.on('connect', handleConnect);\r\n            }\r\n\r\n            socket.on('connect_error', (err) => {\r\n                setStatus(`Connection error: ${err.message}`);\r\n            });\r\n\r\n            socket.on('queue_status', (data) => {\r\n                setStatus('Searching for a partner...');\r\n            });\r\n\r\n            socket.on('match_found', (data) => {\r\n                setStatus('Match Found!');\r\n                setTimeout(() => {\r\n                    onMatchFound(data);\r\n                }, 1000);\r\n            });\r\n\r\n            socket.on('error', (data) => {\r\n                setStatus(`Error: ${data.message}`);\r\n            });\r\n\r\n            return () => {\r\n                socket.off('connect', handleConnect);\r\n                socket.off('connect_error');\r\n                socket.off('queue_status');\r\n                socket.off('match_found');\r\n                socket.off('error');\r\n            };\r\n        };\r\n\r\n        connectAndJoin();\r\n\r\n        return () => {\r\n            // Cleanup handled by logic flow\r\n        };\r\n    }, [onMatchFound, autoJoin, initialPreference]);\r\n\r\n    const handleJoin = (pref: 'male' | 'female' | 'any') => {\r\n        setPreference(pref);\r\n        if (onPreferenceSelect) {\r\n            onPreferenceSelect(pref);\r\n        }\r\n        setStatus(`Searching for ${pref}...`);\r\n        const socket = getSocket();\r\n        socket.emit('join_queue', { preference: pref });\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center justify-center space-y-8 animate-in fade-in duration-500\">\r\n            <div className=\"relative\">\r\n                <div className=\"w-24 h-24 bg-blue-500 rounded-full flex items-center justify-center animate-pulse\">\r\n                    <span className=\"text-4xl\">üîç</span>\r\n                </div>\r\n                {/* Ripple effect */}\r\n                <span className=\"absolute top-0 left-0 w-24 h-24 bg-blue-500 rounded-full animate-ping opacity-25\"></span>\r\n            </div>\r\n\r\n            <div className=\"text-center space-y-2\">\r\n                <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">{status}</h2>\r\n                <p className=\"text-gray-500 dark:text-gray-400\">Finding someone compatible with you...</p>\r\n            </div>\r\n\r\n            {status === 'Select a preference' && (\r\n                <div className=\"flex gap-4\">\r\n                    <button onClick={() => handleJoin('female')} className=\"px-6 py-3 bg-pink-500 hover:bg-pink-600 text-white rounded-full font-semibold transition shadow-lg\">\r\n                        Female\r\n                    </button>\r\n                    <button onClick={() => handleJoin('male')} className=\"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-full font-semibold transition shadow-lg\">\r\n                        Male\r\n                    </button>\r\n                    <button onClick={() => handleJoin('any')} className=\"px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-full font-semibold transition shadow-lg\">\r\n                        Anyone\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            {/* Cancel Button */}\r\n            {status.startsWith('Searching') && (\r\n                <button\r\n                    onClick={() => {\r\n                        window.location.reload(); // Simplest cancel for MVP\r\n                    }}\r\n                    className=\"text-red-500 hover:text-red-700 font-medium text-sm\"\r\n                >\r\n                    Cancel\r\n                </button>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 908, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/ChatInterface.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { getSocket } from '@/utils/socket';\r\nimport { generateDeviceId } from '@/utils/device-id';\r\n\r\ninterface ChatInterfaceProps {\r\n    sessionData: any; // { session_id, partner: { nickname, device_id } }\r\n    onLeave: () => void;\r\n    onNext: () => void;\r\n}\r\n\r\ninterface Message {\r\n    id: string; // or timestamp\r\n    sender_id: string;\r\n    content: string;\r\n    timestamp: string;\r\n    isMe: boolean;\r\n}\r\n\r\nexport default function ChatInterface({ sessionData, onLeave, onNext }: ChatInterfaceProps) {\r\n    const [isConnected, setIsConnected] = useState(true);\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [input, setInput] = useState('');\r\n    const [myId, setMyId] = useState<string>('');\r\n    const [partnerLeft, setPartnerLeft] = useState(false);\r\n\r\n    // Auto-scroll ref\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n    const [partnerTyping, setPartnerTyping] = useState(false);\r\n    const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            const id = await generateDeviceId();\r\n            setMyId(id);\r\n\r\n            const socket = getSocket();\r\n\r\n            // CRITICAL: Join the session room to receive messages\r\n            // The person who triggered the match is added by server, but the partner MUST join explicitly.\r\n            socket.emit('join_session', { session_id: sessionData.session_id });\r\n\r\n            socket.on('new_message', (data) => {\r\n                setPartnerTyping(false); // Clear typing when message received\r\n                setMessages((prev) => [...prev, {\r\n                    id: Date.now().toString(), // Simple ID\r\n                    sender_id: data.sender_id,\r\n                    content: data.content,\r\n                    timestamp: data.timestamp,\r\n                    isMe: data.sender_id === id\r\n                }]);\r\n            });\r\n\r\n            socket.on('partner_left', () => {\r\n                setPartnerLeft(true);\r\n                setPartnerTyping(false);\r\n            });\r\n\r\n            socket.on('partner_typing', (data) => {\r\n                setPartnerTyping(data.is_typing);\r\n            });\r\n\r\n            socket.on('disconnect', () => {\r\n                setIsConnected(false);\r\n            });\r\n\r\n            socket.on('connect', () => {\r\n                setIsConnected(true);\r\n                // Re-join on reconnect\r\n                socket.emit('join_session', { session_id: sessionData.session_id });\r\n            });\r\n        };\r\n\r\n        // Load persisted messages\r\n        const saved = sessionStorage.getItem(`chat_${sessionData.session_id}`);\r\n        if (saved) {\r\n            try {\r\n                setMessages(JSON.parse(saved));\r\n            } catch (e) {\r\n                console.error(\"Failed to parse saved chat\", e);\r\n            }\r\n        }\r\n\r\n        init();\r\n\r\n        return () => {\r\n            const socket = getSocket();\r\n            socket.off('new_message');\r\n            socket.off('partner_left');\r\n            socket.off('partner_typing');\r\n            socket.off('disconnect');\r\n            socket.off('connect');\r\n        };\r\n    }, [sessionData.session_id]);\r\n\r\n    // Scroll to bottom & Persist\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n\r\n        // Persist to session storage\r\n        if (messages.length > 0) {\r\n            sessionStorage.setItem(`chat_${sessionData.session_id}`, JSON.stringify(messages));\r\n        }\r\n    }, [messages, partnerTyping, sessionData.session_id]);\r\n\r\n    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        setInput(e.target.value);\r\n\r\n        const socket = getSocket();\r\n\r\n        // Emit typing start\r\n        socket.emit('typing_start', { session_id: sessionData.session_id });\r\n\r\n        // Debounce stop\r\n        if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current);\r\n        typingTimeoutRef.current = setTimeout(() => {\r\n            socket.emit('typing_stop', { session_id: sessionData.session_id });\r\n        }, 1500);\r\n    };\r\n\r\n    const handleSend = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!input.trim()) return;\r\n\r\n        const socket = getSocket();\r\n        socket.emit('send_message', {\r\n            session_id: sessionData.session_id,\r\n            content: input.trim()\r\n        });\r\n\r\n        // Stop typing immediately on send\r\n        if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current);\r\n        socket.emit('typing_stop', { session_id: sessionData.session_id });\r\n\r\n        setInput('');\r\n    };\r\n\r\n    const handleLeave = () => {\r\n        const socket = getSocket();\r\n        socket.emit('leave_chat', { session_id: sessionData.session_id });\r\n        sessionStorage.removeItem(`chat_${sessionData.session_id}`);\r\n        onLeave();\r\n    };\r\n\r\n    // Also clear on \"Next Match\" (handled by parent onNext usually, but good to clean here OR parent)\r\n    // We'll wrap onNext to clear storage\r\n    const handleNext = () => {\r\n        sessionStorage.removeItem(`chat_${sessionData.session_id}`);\r\n        onNext();\r\n    };\r\n\r\n    const handleReport = () => {\r\n        const reason = prompt(\"Why are you reporting this user?\");\r\n        if (reason) {\r\n            const socket = getSocket();\r\n            socket.emit('report_user', {\r\n                session_id: sessionData.session_id,\r\n                reason: reason,\r\n                reported_device_id: sessionData.partner.device_id\r\n            });\r\n            alert(\"Report submitted.\");\r\n            handleLeave();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full max-w-lg h-[90vh] md:h-[600px] flex flex-col bg-white dark:bg-gray-800 rounded-xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700 animate-in fade-in zoom-in-95 duration-300\">\r\n            {/* Header */}\r\n            <div className=\"p-4 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center\">\r\n                <div>\r\n                    <h3 className=\"font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2\">\r\n                        <span className={`w-2 h-2 rounded-full ${partnerLeft ? 'bg-gray-400' : 'bg-green-500 animate-pulse'}`}></span>\r\n                        {sessionData.partner.nickname || \"Stranger\"}\r\n                    </h3>\r\n                    <p className=\"text-xs text-gray-400\">Encrypted ‚Ä¢ Ephemeral</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <button onClick={handleReport} className=\"text-gray-400 hover:text-red-500 transition\" title=\"Report\">\r\n                        üö©\r\n                    </button>\r\n                    <button onClick={handleLeave} className=\"text-gray-400 hover:text-red-500 transition font-bold\" title=\"Leave\">\r\n                        ‚úï\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Messages Area */}\r\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-100 dark:bg-gray-950/50\">\r\n                {/* System Message */}\r\n                <div className=\"text-center text-xs text-gray-400 my-4\">\r\n                    Session Started. Say hi! üëã\r\n                </div>\r\n\r\n                {messages.map((msg, idx) => (\r\n                    <div key={idx} className={`flex ${msg.isMe ? 'justify-end' : 'justify-start'}`}>\r\n                        <div className={`max-w-[75%] p-3 rounded-2xl text-sm shadow-sm ${msg.isMe\r\n                            ? 'bg-blue-600 text-white rounded-br-none'\r\n                            : 'bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded-bl-none border border-gray-200 dark:border-gray-700'\r\n                            }`}>\r\n                            {msg.content}\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n\r\n                {partnerTyping && (\r\n                    <div className=\"flex justify-start animate-in fade-in slide-in-from-bottom-1\">\r\n                        <div className=\"bg-gray-200 dark:bg-gray-800 p-3 rounded-2xl rounded-bl-none text-xs text-gray-500 flex gap-1 items-center\">\r\n                            <span className=\"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce [animation-delay:-0.3s]\"></span>\r\n                            <span className=\"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce [animation-delay:-0.15s]\"></span>\r\n                            <span className=\"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce\"></span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {partnerLeft && (\r\n                    <div className=\"text-center py-4 space-y-2\">\r\n                        <p className=\"text-gray-500 text-sm\">Partner left the chat.</p>\r\n                        <button onClick={handleNext} className=\"px-4 py-2 bg-blue-600 text-white rounded-full text-sm font-bold shadow-lg hover:bg-blue-700 transition\">\r\n                            Find Next Match ‚ûî\r\n                        </button>\r\n                    </div>\r\n                )}\r\n                <div ref={messagesEndRef} />\r\n            </div>\r\n\r\n            {/* Input Area */}\r\n            <form onSubmit={handleSend} className=\"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex gap-2\">\r\n                <input\r\n                    type=\"text\"\r\n                    value={input}\r\n                    onChange={handleInputChange}\r\n                    placeholder={partnerLeft ? \"Session ended.\" : \"Type a message...\"}\r\n                    disabled={partnerLeft}\r\n                    className=\"flex-1 p-3 rounded-full bg-gray-100 dark:bg-gray-900 border-0 focus:ring-2 focus:ring-blue-500 outline-none transition\"\r\n                />\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={!input.trim() || partnerLeft}\r\n                    className=\"p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 disabled:scale-95 transition shadow-md w-12 h-12 flex items-center justify-center transform active:scale-95\"\r\n                >\r\n                    ‚û§\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1312, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/Dashboard.tsx"],"sourcesContent":["import React from 'react';\r\n\r\ninterface DashboardProps {\r\n    onStartChat: () => void;\r\n    onEditProfile: () => void;\r\n}\r\n\r\nexport default function Dashboard({ onStartChat, onEditProfile }: DashboardProps) {\r\n    return (\r\n        <div className=\"w-full max-w-lg bg-white dark:bg-gray-900 rounded-2xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-800 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n            {/* Hero Section */}\r\n            <div className=\"p-8 pb-12 bg-gradient-to-br from-blue-600 to-indigo-700 text-center relative overflow-hidden\">\r\n                <div className=\"absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]\"></div>\r\n\r\n                <h2 className=\"text-3xl font-extrabold text-white mb-2 relative z-10\">\r\n                    Welcome to Klymo\r\n                </h2>\r\n                <p className=\"text-blue-100 relative z-10\">\r\n                    Your space to connect and vibe.\r\n                </p>\r\n            </div>\r\n\r\n            {/* Action Center - Floating Card Effect */}\r\n            <div className=\"px-6 -mt-8 relative z-20\">\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-100 dark:border-gray-700 text-center\">\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-4\">\r\n                        Ready to meet someone new?\r\n                    </p>\r\n                    <button\r\n                        onClick={onStartChat}\r\n                        className=\"w-full py-4 bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-xl font-bold text-lg shadow-md transition-all transform hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2 group\"\r\n                    >\r\n                        <span>Start Matching</span>\r\n                        <span className=\"group-hover:translate-x-1 transition-transform\">üöÄ</span>\r\n                    </button>\r\n                    <p className=\"text-xs text-gray-400 mt-3\">\r\n                        {Math.floor(Math.random() * 500) + 120} users online now\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Fun Activities Grid */}\r\n            <div className=\"p-6\">\r\n                <h3 className=\"text-sm font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider mb-4\">\r\n                    Daily Activities\r\n                </h3>\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-100 dark:border-gray-700 hover:border-blue-200 dark:hover:border-blue-800 transition cursor-pointer group\">\r\n                        <div className=\"text-2xl mb-2 group-hover:scale-110 transition-transform\">üó≥Ô∏è</div>\r\n                        <h4 className=\"font-bold text-sm text-gray-800 dark:text-gray-200\">Daily Poll</h4>\r\n                        <p className=\"text-xs text-gray-400\">Vote on today's topic</p>\r\n                    </div>\r\n                    <div className=\"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-100 dark:border-gray-700 hover:border-purple-200 dark:hover:border-purple-800 transition cursor-pointer group\">\r\n                        <div className=\"text-2xl mb-2 group-hover:scale-110 transition-transform\">üé≠</div>\r\n                        <h4 className=\"font-bold text-sm text-gray-800 dark:text-gray-200\">Mood Check</h4>\r\n                        <p className=\"text-xs text-gray-400\">How are you feeling?</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"mt-6 text-center\">\r\n                    <button\r\n                        onClick={onEditProfile}\r\n                        className=\"text-sm text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition underline underline-offset-4\"\r\n                    >\r\n                        Edit Profile\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;;AAOe,SAAS,UAAU,EAAE,WAAW,EAAE,aAAa,EAAkB;IAC5E,qBACI,6LAAC;QAAI,WAAU;;0BAEX,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAI,WAAU;;;;;;kCAEf,6LAAC;wBAAG,WAAU;kCAAwD;;;;;;kCAGtE,6LAAC;wBAAE,WAAU;kCAA8B;;;;;;;;;;;;0BAM/C,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAE,WAAU;sCAAgD;;;;;;sCAG7D,6LAAC;4BACG,SAAS;4BACT,WAAU;;8CAEV,6LAAC;8CAAK;;;;;;8CACN,6LAAC;oCAAK,WAAU;8CAAiD;;;;;;;;;;;;sCAErE,6LAAC;4BAAE,WAAU;;gCACR,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,OAAO;gCAAI;;;;;;;;;;;;;;;;;;0BAMnD,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAG,WAAU;kCAAmF;;;;;;kCAGjG,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAI,WAAU;kDAA2D;;;;;;kDAC1E,6LAAC;wCAAG,WAAU;kDAAqD;;;;;;kDACnE,6LAAC;wCAAE,WAAU;kDAAwB;;;;;;;;;;;;0CAEzC,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAI,WAAU;kDAA2D;;;;;;kDAC1E,6LAAC;wCAAG,WAAU;kDAAqD;;;;;;kDACnE,6LAAC;wCAAE,WAAU;kDAAwB;;;;;;;;;;;;;;;;;;kCAI7C,6LAAC;wBAAI,WAAU;kCACX,cAAA,6LAAC;4BACG,SAAS;4BACT,WAAU;sCACb;;;;;;;;;;;;;;;;;;;;;;;AAOrB;KA/DwB"}},
    {"offset": {"line": 1539, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { generateDeviceId } from '@/utils/device-id';\nimport CameraCapture from \"@/components/CameraCapture\";\nimport ProfileForm from \"@/components/ProfileForm\";\nimport MatchingQueue from \"@/components/MatchingQueue\";\nimport ChatInterface from \"@/components/ChatInterface\";\nimport Dashboard from \"@/components/Dashboard\";\n\nexport default function Home() {\n  const [step, setStep] = useState<'verification' | 'profile' | 'home' | 'chat'>('verification');\n  const [chatSession, setChatSession] = useState<any>(null); // To store session data\n  const [lastPreference, setLastPreference] = useState<'male' | 'female' | 'any'>('any');\n  const [isAutoJoining, setIsAutoJoining] = useState(false);\n\n  // Initialize Device ID silently on load\n  useEffect(() => {\n    generateDeviceId().catch(console.error);\n  }, []);\n\n  // Callback when CameraCapture successfully verifies\n  const handleVerificationSuccess = () => {\n    setStep('profile');\n  };\n\n  // Callback when Profile is saved\n  const handleProfileComplete = () => {\n    console.log(\"Setting step to home\");\n    setStep('home');\n  };\n\n  const handleStartChat = () => {\n    setIsAutoJoining(false); // Reset auto join state when starting fresh\n    setStep('chat');\n  };\n\n  const handleMatchFound = (sessionData: any) => {\n    setChatSession(sessionData);\n    setIsAutoJoining(false); // Clear auto-join flag once matched\n  };\n\n  const handleLeaveChat = () => {\n    setChatSession(null);\n    setIsAutoJoining(false);\n    // Return to dashboard after chat? or Queue? \n    // Usually dashboard is better UX to take a break.\n    setStep('home');\n  };\n\n  const handleNextMatch = () => {\n    // Leave current chat and immediately queue again with same preference\n    setChatSession(null);\n    setIsAutoJoining(true);\n  };\n\n  return (\n    <div className=\"grid grid-rows-[20px_1fr_20px] items-center justify-items-center min-h-screen p-8 pb-20 gap-16 sm:p-20 font-[family-name:var(--font-geist-sans)]\">\n      <main className=\"flex flex-col gap-8 row-start-2 items-center sm:items-start w-full max-w-lg\">\n        <div className=\"w-full text-center sm:text-left\">\n          <h1 className=\"text-3xl font-bold mb-2\">Klymo</h1>\n        </div>\n\n        <div className=\"w-full transition-all duration-500\">\n          {step === 'verification' && (\n            <CameraCapture onCapture={handleVerificationSuccess} />\n          )}\n\n          {step === 'profile' && (\n            <ProfileForm onProfileComplete={handleProfileComplete} />\n          )}\n\n          {step === 'home' && (\n            <Dashboard\n              onStartChat={handleStartChat}\n              onEditProfile={() => setStep('profile')}\n            />\n          )}\n\n          {step === 'chat' && (\n            <>\n              {!chatSession ? (\n                <MatchingQueue\n                  onMatchFound={handleMatchFound}\n                  autoJoin={isAutoJoining}\n                  initialPreference={lastPreference}\n                  onPreferenceSelect={setLastPreference}\n                />\n              ) : (\n                <ChatInterface\n                  sessionData={chatSession}\n                  onLeave={handleLeaveChat}\n                  onNext={handleNextMatch}\n                />\n              )}\n\n              {!chatSession && (\n                <div className=\"mt-8 text-center\">\n                  <button\n                    onClick={() => setStep('home')}\n                    className=\"text-sm text-gray-500 hover:underline\"\n                  >\n                    Back to Dashboard\n                  </button>\n                </div>\n              )}\n            </>\n          )}\n        </div>\n      </main>\n\n      {/* Footer can be simplified or removed */}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AARA;;;;;;;;AAUe,SAAS;;IACtB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAA+C;IAC/E,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAM,OAAO,wBAAwB;IACnF,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAA4B;IAChF,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IAEnD,wCAAwC;IACxC,IAAA,0KAAS;0BAAC;YACR,IAAA,mJAAgB,IAAG,KAAK,CAAC,QAAQ,KAAK;QACxC;yBAAG,EAAE;IAEL,oDAAoD;IACpD,MAAM,4BAA4B;QAChC,QAAQ;IACV;IAEA,iCAAiC;IACjC,MAAM,wBAAwB;QAC5B,QAAQ,GAAG,CAAC;QACZ,QAAQ;IACV;IAEA,MAAM,kBAAkB;QACtB,iBAAiB,QAAQ,4CAA4C;QACrE,QAAQ;IACV;IAEA,MAAM,mBAAmB,CAAC;QACxB,eAAe;QACf,iBAAiB,QAAQ,oCAAoC;IAC/D;IAEA,MAAM,kBAAkB;QACtB,eAAe;QACf,iBAAiB;QACjB,6CAA6C;QAC7C,kDAAkD;QAClD,QAAQ;IACV;IAEA,MAAM,kBAAkB;QACtB,sEAAsE;QACtE,eAAe;QACf,iBAAiB;IACnB;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAK,WAAU;;8BACd,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAG,WAAU;kCAA0B;;;;;;;;;;;8BAG1C,6LAAC;oBAAI,WAAU;;wBACZ,SAAS,gCACR,6LAAC,iJAAa;4BAAC,WAAW;;;;;;wBAG3B,SAAS,2BACR,6LAAC,+IAAW;4BAAC,mBAAmB;;;;;;wBAGjC,SAAS,wBACR,6LAAC,6IAAS;4BACR,aAAa;4BACb,eAAe,IAAM,QAAQ;;;;;;wBAIhC,SAAS,wBACR;;gCACG,CAAC,4BACA,6LAAC,iJAAa;oCACZ,cAAc;oCACd,UAAU;oCACV,mBAAmB;oCACnB,oBAAoB;;;;;yDAGtB,6LAAC,iJAAa;oCACZ,aAAa;oCACb,SAAS;oCACT,QAAQ;;;;;;gCAIX,CAAC,6BACA,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC;wCACC,SAAS,IAAM,QAAQ;wCACvB,WAAU;kDACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAanB;GAxGwB;KAAA"}}]
}