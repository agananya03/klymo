{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/src/utils/device-id.ts"],"sourcesContent":["import FingerprintJS from '@fingerprintjs/fingerprintjs';\r\nimport { openDB } from 'idb';\r\n\r\nconst DB_NAME = 'anonymousChat';\r\nconst STORE_NAME = 'identity';\r\nconst KEY_NAME = 'deviceId';\r\n\r\nasync function getStoredDeviceId(): Promise<string | undefined> {\r\n  try {\r\n    const db = await openDB(DB_NAME, 1, {\r\n      upgrade(db) {\r\n        db.createObjectStore(STORE_NAME);\r\n      },\r\n    });\r\n    return await db.get(STORE_NAME, KEY_NAME);\r\n  } catch (error) {\r\n    console.error('Error accessing IndexedDB:', error);\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function storeDeviceId(deviceId: string): Promise<void> {\r\n  try {\r\n    const db = await openDB(DB_NAME, 1);\r\n    await db.put(STORE_NAME, deviceId, KEY_NAME);\r\n  } catch (error) {\r\n    console.error('Error storing to IndexedDB:', error);\r\n  }\r\n}\r\n\r\nasync function hashString(str: string): Promise<string> {\r\n  const msgBuffer = new TextEncoder().encode(str);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\nexport async function generateDeviceId(): Promise<string> {\r\n  // 1. Check if ID already exists in IndexedDB\r\n  const storedId = await getStoredDeviceId();\r\n  if (storedId) {\r\n    console.log('Device ID retrieved from storage:', storedId);\r\n    return storedId;\r\n  }\r\n\r\n  // 2. Initialize FingerprintJS\r\n  const fp = await FingerprintJS.load();\r\n  const result = await fp.get();\r\n  \r\n  // 3. Collect entropy sources\r\n  const entropy = {\r\n    visitorId: result.visitorId,\r\n    language: navigator.language,\r\n    screenWidth: screen.width,\r\n    screenHeight: screen.height,\r\n    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,\r\n    userAgent: navigator.userAgent,\r\n  };\r\n\r\n  // 4. Create a consistent string from entropy\r\n  // Sorting keys to ensure consistency regardless of object property order\r\n  const entropyString = Object.keys(entropy)\r\n    .sort()\r\n    .map((key) => `${key}:${entropy[key as keyof typeof entropy]}`)\r\n    .join('|');\r\n\r\n  console.log('Entropy string for hashing:', entropyString);\r\n\r\n  // 5. Hash the combined string\r\n  const deviceId = await hashString(entropyString);\r\n\r\n  // 6. Store in IndexedDB\r\n  await storeDeviceId(deviceId);\r\n  console.log('New Device ID generated and stored:', deviceId);\r\n\r\n  return deviceId;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,UAAU;AAChB,MAAM,aAAa;AACnB,MAAM,WAAW;AAEjB,eAAe;IACb,IAAI;QACF,MAAM,KAAK,MAAM,IAAA,kJAAM,EAAC,SAAS,GAAG;YAClC,SAAQ,EAAE;gBACR,GAAG,iBAAiB,CAAC;YACvB;QACF;QACA,OAAO,MAAM,GAAG,GAAG,CAAC,YAAY;IAClC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACT;AACF;AAEA,eAAe,cAAc,QAAgB;IAC3C,IAAI;QACF,MAAM,KAAK,MAAM,IAAA,kJAAM,EAAC,SAAS;QACjC,MAAM,GAAG,GAAG,CAAC,YAAY,UAAU;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;IAC/C;AACF;AAEA,eAAe,WAAW,GAAW;IACnC,MAAM,YAAY,IAAI,cAAc,MAAM,CAAC;IAC3C,MAAM,aAAa,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACzD,MAAM,YAAY,MAAM,IAAI,CAAC,IAAI,WAAW;IAC5C,OAAO,UAAU,GAAG,CAAC,CAAC,IAAM,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,MAAM,IAAI,CAAC;AACpE;AAEO,eAAe;IACpB,6CAA6C;IAC7C,MAAM,WAAW,MAAM;IACvB,IAAI,UAAU;QACZ,QAAQ,GAAG,CAAC,qCAAqC;QACjD,OAAO;IACT;IAEA,8BAA8B;IAC9B,MAAM,KAAK,MAAM,mLAAa,CAAC,IAAI;IACnC,MAAM,SAAS,MAAM,GAAG,GAAG;IAE3B,6BAA6B;IAC7B,MAAM,UAAU;QACd,WAAW,OAAO,SAAS;QAC3B,UAAU,UAAU,QAAQ;QAC5B,aAAa,OAAO,KAAK;QACzB,cAAc,OAAO,MAAM;QAC3B,UAAU,KAAK,cAAc,GAAG,eAAe,GAAG,QAAQ;QAC1D,WAAW,UAAU,SAAS;IAChC;IAEA,6CAA6C;IAC7C,yEAAyE;IACzE,MAAM,gBAAgB,OAAO,IAAI,CAAC,SAC/B,IAAI,GACJ,GAAG,CAAC,CAAC,MAAQ,GAAG,IAAI,CAAC,EAAE,OAAO,CAAC,IAA4B,EAAE,EAC7D,IAAI,CAAC;IAER,QAAQ,GAAG,CAAC,+BAA+B;IAE3C,8BAA8B;IAC9B,MAAM,WAAW,MAAM,WAAW;IAElC,wBAAwB;IACxB,MAAM,cAAc;IACpB,QAAQ,GAAG,CAAC,uCAAuC;IAEnD,OAAO;AACT"}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/DeviceIdDisplay.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { generateDeviceId } from '@/utils/device-id';\r\n\r\nexport default function DeviceIdDisplay() {\r\n    const [deviceId, setDeviceId] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        let mounted = true;\r\n\r\n        async function fetchId() {\r\n            try {\r\n                const id = await generateDeviceId();\r\n                if (mounted) {\r\n                    setDeviceId(id);\r\n                }\r\n            } catch (error) {\r\n                console.error('Failed to generate device ID', error);\r\n            } finally {\r\n                if (mounted) {\r\n                    setLoading(false);\r\n                }\r\n            }\r\n        }\r\n\r\n        fetchId();\r\n\r\n        return () => {\r\n            mounted = false;\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"p-4 bg-gray-100 rounded-lg shadow-sm border border-gray-200 max-w-md mt-4 dark:bg-gray-800 dark:border-gray-700\">\r\n            <h3 className=\"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2 dark:text-gray-400\">\r\n                Device Identity\r\n            </h3>\r\n            {loading ? (\r\n                <div className=\"animate-pulse h-6 w-3/4 bg-gray-300 rounded dark:bg-gray-700\"></div>\r\n            ) : (\r\n                <div className=\"flex flex-col gap-1\">\r\n                    <code className=\"bg-white px-2 py-1 rounded border border-gray-200 font-mono text-sm break-all text-gray-800 dark:bg-gray-900 dark:border-gray-600 dark:text-gray-200\">\r\n                        {deviceId || 'Error generating ID'}\r\n                    </code>\r\n                    <p className=\"text-xs text-gray-400 mt-1\">\r\n                        Persisted in IndexedDB. Hashed from browser entropy.\r\n                    </p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS;;IACpB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAgB;IACxD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,IAAA,0KAAS;qCAAC;YACN,IAAI,UAAU;YAEd,eAAe;gBACX,IAAI;oBACA,MAAM,KAAK,MAAM,IAAA,mJAAgB;oBACjC,IAAI,SAAS;wBACT,YAAY;oBAChB;gBACJ,EAAE,OAAO,OAAO;oBACZ,QAAQ,KAAK,CAAC,gCAAgC;gBAClD,SAAU;oBACN,IAAI,SAAS;wBACT,WAAW;oBACf;gBACJ;YACJ;YAEA;YAEA;6CAAO;oBACH,UAAU;gBACd;;QACJ;oCAAG,EAAE;IAEL,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAG,WAAU;0BAAsF;;;;;;YAGnG,wBACG,6LAAC;gBAAI,WAAU;;;;;qCAEf,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAK,WAAU;kCACX,YAAY;;;;;;kCAEjB,6LAAC;wBAAE,WAAU;kCAA6B;;;;;;;;;;;;;;;;;;AAO9D;GAhDwB;KAAA"}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/CameraCapture.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { generateDeviceId } from '@/utils/device-id';\r\n\r\ninterface CameraCaptureProps {\r\n    onCapture?: (blobSize: string) => void;\r\n}\r\n\r\nexport default function CameraCapture({ onCapture }: CameraCaptureProps) {\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [isStreaming, setIsStreaming] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [verificationStatus, setVerificationStatus] = useState<'idle' | 'success' | 'failed'>('idle');\r\n    const [verificationMessage, setVerificationMessage] = useState<string>('');\r\n\r\n    const startCamera = async () => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        setVerificationStatus('idle');\r\n        setVerificationMessage('');\r\n\r\n        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n            setError(\"Camera API is not supported in this browser\");\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Strict constraint for user-facing camera\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                video: { facingMode: 'user', width: 640, height: 480 }\r\n            });\r\n\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = stream;\r\n                videoRef.current.onloadedmetadata = () => {\r\n                    videoRef.current?.play().catch(e => console.error(\"Play error:\", e));\r\n                    setIsStreaming(true);\r\n                    setIsLoading(false);\r\n                };\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Error accessing camera:\", err);\r\n            setError(`Camera access denied. Please allow permissions to verify.`);\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const stopCamera = useCallback(() => {\r\n        if (videoRef.current && videoRef.current.srcObject) {\r\n            const stream = videoRef.current.srcObject as MediaStream;\r\n            const tracks = stream.getTracks();\r\n            tracks.forEach(track => track.stop());\r\n            videoRef.current.srcObject = null;\r\n            setIsStreaming(false);\r\n        }\r\n    }, []);\r\n\r\n    const captureAndVerify = async () => {\r\n        if (!videoRef.current || !canvasRef.current) return;\r\n\r\n        setIsLoading(true);\r\n        const canvas = canvasRef.current;\r\n        const video = videoRef.current;\r\n\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            setError(\"Internal error: Canvas context missing\");\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n\r\n        // Draw current frame\r\n        ctx.drawImage(video, 0, 0);\r\n\r\n        // Convert to Blob (JPEG 92%)\r\n        canvas.toBlob(async (blob) => {\r\n            if (!blob) {\r\n                setError(\"Failed to capture image\");\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            // Immediately stop camera privacy rule\r\n            stopCamera();\r\n\r\n            try {\r\n                const deviceId = await generateDeviceId();\r\n                console.log(\"Starting verification request...\"); // Force HMR update\r\n                const formData = new FormData();\r\n                formData.append('file', blob, 'capture.jpg');\r\n                formData.append('device_id', deviceId);\r\n\r\n                // Use relative path to leverage Next.js proxy\r\n                const response = await fetch('/api/v1/verification/verify-gender', {\r\n                    method: 'POST',\r\n                    body: formData,\r\n                });\r\n\r\n                const result = await response.json();\r\n\r\n                if (!response.ok) {\r\n                    throw new Error(result.detail || 'Verification failed');\r\n                }\r\n\r\n                setVerificationStatus('success');\r\n                setVerificationMessage(`Verified as ${result.gender} (${(result.confidence * 100).toFixed(1)}%)`);\r\n\r\n                // Trigger parent callback after short delay for UX\r\n                if (onCapture) {\r\n                    setTimeout(() => onCapture(blob.size.toString()), 1500);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Verification error:\", err);\r\n                setVerificationStatus('failed');\r\n                setVerificationMessage(err instanceof Error ? err.message : \"Verification failed\");\r\n                // Allow retrying\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n\r\n        }, 'image/jpeg', 0.92);\r\n    };\r\n\r\n    // Cleanup\r\n    useEffect(() => {\r\n        return () => stopCamera();\r\n    }, [stopCamera]);\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center gap-6 p-6 border rounded-xl shadow-lg max-w-lg mx-auto bg-white dark:bg-gray-800 transition-all\">\r\n            <h3 className=\"text-xl font-bold text-gray-800 dark:text-white\">\r\n                Identity Verification\r\n            </h3>\r\n\r\n            <div className={`relative w-full aspect-video bg-black rounded-lg overflow-hidden border-2 ${verificationStatus === 'success' ? 'border-green-500' :\r\n                verificationStatus === 'failed' ? 'border-red-500' : 'border-gray-200 dark:border-gray-700'\r\n                }`}>\r\n\r\n                {/* Initial State / Messages */}\r\n                {!isStreaming && (\r\n                    <div className=\"absolute inset-0 flex flex-col items-center justify-center p-4 text-center z-10 bg-black/80 text-white\">\r\n                        {verificationStatus === 'success' ? (\r\n                            <div className=\"text-green-400\">\r\n                                <span className=\"text-4xl\">✓</span>\r\n                                <p className=\"mt-2 font-semibold\">{verificationMessage}</p>\r\n                                <p className=\"text-sm opacity-75 mt-1\">Image discarded for privacy.</p>\r\n                            </div>\r\n                        ) : verificationStatus === 'failed' ? (\r\n                            <div className=\"text-red-400\">\r\n                                <span className=\"text-4xl\">⚠</span>\r\n                                <p className=\"mt-2 font-semibold\">{verificationMessage}</p>\r\n                                <button\r\n                                    onClick={startCamera}\r\n                                    className=\"mt-4 px-4 py-2 bg-white text-red-600 rounded-full text-sm font-bold hover:bg-gray-200\"\r\n                                >\r\n                                    Try Again\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-4\">\r\n                                <p className=\"text-sm opacity-90 max-w-xs mx-auto\">\r\n                                    Instant camera-only verification. No uploads allowed.\r\n                                    Images are processed in memory and immediately deleted.\r\n                                </p>\r\n                                <button\r\n                                    onClick={startCamera}\r\n                                    disabled={isLoading}\r\n                                    className=\"px-6 py-3 bg-blue-600 rounded-full font-bold hover:bg-blue-700 transition disabled:opacity-50\"\r\n                                >\r\n                                    {isLoading ? 'Starting...' : 'Enable Camera'}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n\r\n                        {error && (\r\n                            <p className=\"mt-4 text-red-500 bg-black/90 px-3 py-1 rounded\">{error}</p>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                <video\r\n                    ref={videoRef}\r\n                    className=\"w-full h-full object-cover\"\r\n                    playsInline\r\n                    muted\r\n                    autoPlay\r\n                />\r\n            </div>\r\n\r\n            {isStreaming && (\r\n                <div className=\"flex flex-col items-center gap-3 w-full\">\r\n                    <button\r\n                        onClick={captureAndVerify}\r\n                        disabled={isLoading}\r\n                        className=\"w-full px-6 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 shadow-lg transition transform active:scale-98 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                        {isLoading ? 'Verifying...' : 'Verify Identity'}\r\n                    </button>\r\n                    <p className=\"text-xs text-gray-400\">\r\n                        By verifying, you confirm this is your real photo.\r\n                    </p>\r\n                </div>\r\n            )}\r\n\r\n            <canvas ref={canvasRef} className=\"hidden\" />\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 505, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/ProfileForm.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { generateDeviceId } from '@/utils/device-id';\r\n\r\ninterface ProfileFormProps {\r\n    onProfileComplete: () => void;\r\n}\r\n\r\nexport default function ProfileForm({ onProfileComplete }: ProfileFormProps) {\r\n    const [nickname, setNickname] = useState('');\r\n    const [bio, setBio] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [status, setStatus] = useState<string | null>(null);\r\n    const [deviceId, setDeviceId] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        // Load device ID and check for existing profile\r\n        const loadProfile = async () => {\r\n            const id = await generateDeviceId();\r\n            setDeviceId(id);\r\n            try {\r\n                // Use relative path for proxy\r\n                const res = await fetch(`/api/v1/profiles/${id}`);\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    if (data.nickname) setNickname(data.nickname);\r\n                    if (data.bio) setBio(data.bio);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to load profile\", err);\r\n            }\r\n        };\r\n        loadProfile();\r\n    }, []);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!deviceId) return;\r\n\r\n        setIsLoading(true);\r\n        setStatus(null);\r\n\r\n        try {\r\n            const res = await fetch('/api/v1/profiles/', {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    device_id: deviceId,\r\n                    nickname: nickname.trim(),\r\n                    bio: bio.trim()\r\n                }),\r\n            });\r\n\r\n            if (!res.ok) throw new Error('Failed to save profile');\r\n\r\n            setStatus('Profile saved successfully!');\r\n            setTimeout(onProfileComplete, 1000); // Proceed after delay\r\n        } catch (err) {\r\n            setStatus('Error saving profile. Please try again.');\r\n            console.error(err);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleClear = async () => {\r\n        if (!deviceId || !confirm(\"Are you sure you want to clear your profile data?\")) return;\r\n\r\n        setIsLoading(true);\r\n        try {\r\n            const res = await fetch(`/api/v1/profiles/${deviceId}`, {\r\n                method: 'DELETE'\r\n            });\r\n            if (!res.ok) throw new Error('Failed to clear profile');\r\n\r\n            setNickname('');\r\n            setBio('');\r\n            setStatus('Profile data cleared.');\r\n        } catch (err) {\r\n            setStatus('Error clearing data.');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full max-w-md p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n            <h3 className=\"text-xl font-bold mb-2 text-gray-900 dark:text-gray-100\">Setup Profile</h3>\r\n            <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-6\">\r\n                Your nickname is temporary. No profile pictures are allowed for privacy.\r\n            </p>\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                <div>\r\n                    <label className=\"block text-xs font-semibold uppercase text-gray-500 mb-1\">Nickname</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        value={nickname}\r\n                        onChange={(e) => setNickname(e.target.value)}\r\n                        placeholder=\"e.g. MysteryWalker\"\r\n                        maxLength={50}\r\n                        required\r\n                        className=\"w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none transition\"\r\n                    />\r\n                </div>\r\n\r\n                <div>\r\n                    <label className=\"block text-xs font-semibold uppercase text-gray-500 mb-1\">Short Bio (Optional)</label>\r\n                    <textarea\r\n                        value={bio}\r\n                        onChange={(e) => setBio(e.target.value)}\r\n                        placeholder=\"Just here to chat...\"\r\n                        maxLength={200}\r\n                        rows={3}\r\n                        className=\"w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none transition resize-none\"\r\n                    />\r\n                </div>\r\n\r\n                {status && (\r\n                    <p className={`text-sm text-center font-medium ${status.includes('Error') ? 'text-red-500' : 'text-green-500'}`}>\r\n                        {status}\r\n                    </p>\r\n                )}\r\n\r\n                <div className=\"flex gap-3 pt-2\">\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={isLoading || !nickname.trim()}\r\n                        className=\"flex-1 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition transform active:scale-95\"\r\n                    >\r\n                        {isLoading ? 'Saving...' : 'Continue'}\r\n                    </button>\r\n                    {nickname && (\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={handleClear}\r\n                            disabled={isLoading}\r\n                            className=\"px-4 py-3 text-red-500 font-semibold hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition\"\r\n                            title=\"Clear Profile Data\"\r\n                        >\r\n                            Clear\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 734, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport DeviceIdDisplay from \"@/components/DeviceIdDisplay\";\nimport CameraCapture from \"@/components/CameraCapture\";\nimport ProfileForm from \"@/components/ProfileForm\";\n\nexport default function Home() {\n  const [step, setStep] = useState<'verification' | 'profile' | 'chat'>('verification');\n\n  // Callback when CameraCapture successfully verifies\n  const handleVerificationSuccess = () => {\n    setStep('profile');\n  };\n\n  // Callback when Profile is saved\n  const handleProfileComplete = () => {\n    setStep('chat');\n  };\n\n  return (\n    <div className=\"grid grid-rows-[20px_1fr_20px] items-center justify-items-center min-h-screen p-8 pb-20 gap-16 sm:p-20 font-[family-name:var(--font-geist-sans)]\">\n      <main className=\"flex flex-col gap-8 row-start-2 items-center sm:items-start w-full max-w-lg\">\n        <div className=\"w-full text-center sm:text-left\">\n          <h1 className=\"text-3xl font-bold mb-2\">Klymo</h1>\n          <DeviceIdDisplay />\n        </div>\n\n        <div className=\"w-full transition-all duration-500\">\n          {step === 'verification' && (\n            <CameraCapture onCapture={handleVerificationSuccess} />\n          )}\n\n          {step === 'profile' && (\n            <ProfileForm onProfileComplete={handleProfileComplete} />\n          )}\n\n          {step === 'chat' && (\n            <div className=\"p-8 border rounded-xl bg-white dark:bg-gray-800 shadow-md text-center animate-in fade-in zoom-in duration-500\">\n              <h2 className=\"text-2xl font-bold text-green-600 mb-4\">You are ready!</h2>\n              <p className=\"text-gray-600 dark:text-gray-300\">\n                Profile setup complete. <br />\n                (Chat interface coming soon...)\n              </p>\n              <button\n                onClick={() => setStep('profile')}\n                className=\"mt-6 text-sm text-blue-500 hover:underline\"\n              >\n                Edit Profile\n              </button>\n            </div>\n          )}\n        </div>\n      </main>\n\n      {/* Footer can be simplified or removed */}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAOe,SAAS;;IACtB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAsC;IAEtE,oDAAoD;IACpD,MAAM,4BAA4B;QAChC,QAAQ;IACV;IAEA,iCAAiC;IACjC,MAAM,wBAAwB;QAC5B,QAAQ;IACV;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAK,WAAU;;8BACd,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAA0B;;;;;;sCACxC,6LAAC,mJAAe;;;;;;;;;;;8BAGlB,6LAAC;oBAAI,WAAU;;wBACZ,SAAS,gCACR,6LAAC,iJAAa;4BAAC,WAAW;;;;;;wBAG3B,SAAS,2BACR,6LAAC,+IAAW;4BAAC,mBAAmB;;;;;;wBAGjC,SAAS,wBACR,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAG,WAAU;8CAAyC;;;;;;8CACvD,6LAAC;oCAAE,WAAU;;wCAAmC;sDACtB,6LAAC;;;;;wCAAK;;;;;;;8CAGhC,6LAAC;oCACC,SAAS,IAAM,QAAQ;oCACvB,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWf;GAnDwB;KAAA"}}]
}